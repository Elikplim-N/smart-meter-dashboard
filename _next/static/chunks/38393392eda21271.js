(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,31713,e=>{"use strict";e.s(["default",()=>j],31713);var t=e.i(43476),r=e.i(71645);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class s{async connect(){try{var e;let t=navigator;this.port=await t.serial.requestPort(),await this.port.open({baudRate:115200}),this.isConnected=!0;let r=new TextEncoderStream,a=new TextDecoderStream;r.readable.pipeTo(this.port.writable),this.port.readable.pipeTo(a.writable),this.reader=a.readable.getReader(),this.writer=r.writable.getWriter(),null==(e=this.onConnectCallback)||e.call(this),this.readLoop()}catch(e){throw console.error("Failed to connect:",e),this.isConnected=!1,e}}async disconnect(){try{var e;this.isConnected=!1,this.reader&&(this.reader.cancel(),this.reader=null),this.writer&&(await this.writer.close(),this.writer=null),this.port&&(await this.port.close(),this.port=null),null==(e=this.onDisconnectCallback)||e.call(this)}catch(e){console.error("Disconnect error:",e)}}async sendCommand(e){if(!this.writer)throw Error("Not connected");await this.writer.write(e+"\n")}async readLoop(){if(this.reader)try{let e="";for(;this.isConnected;){let{value:t,done:r}=await this.reader.read();if(r)break;let a=(e+=t).split("\n");for(let t of(e=a.pop()||"",a))this.parseLine(t.trim())}}catch(e){this.isConnected&&(console.error("Read loop error:",e),this.disconnect())}}parseLine(e){if(e){if(e.startsWith("DATA:"))try{let a=e.substring(5).split(","),s={};for(let e of a){let[t,r]=e.split("=");t&&r&&(s[t.toLowerCase()]=parseFloat(r))}if(void 0!==s.v&&void 0!==s.i&&void 0!==s.p){var t,r;let e={voltage:s.v,current:s.i,power:s.p,theft:null!=(r=s.theft)?r:0,alert:1===s.alert,relay:1===s.relay,timestamp:Date.now()};null==(t=this.onDataCallback)||t.call(this,e)}}catch(t){console.error("Failed to parse line:",e,t)}(e.startsWith("OK:")||e.startsWith("ERR:")||e.startsWith("HTTP"))&&console.log("[Device]",e)}}onData(e){this.onDataCallback=e}onConnect(e){this.onConnectCallback=e}onDisconnect(e){this.onDisconnectCallback=e}getConnected(){return this.isConnected}constructor(){a(this,"port",null),a(this,"reader",null),a(this,"writer",null),a(this,"onDataCallback",null),a(this,"onConnectCallback",null),a(this,"onDisconnectCallback",null),a(this,"isConnected",!1)}}let l={saveAlerts(e){localStorage.setItem("alertLogs",JSON.stringify(e))},loadAlerts(){{let e=localStorage.getItem("alertLogs");return e?JSON.parse(e):[]}},saveLastLocation(e,t){localStorage.setItem("lastLocation",JSON.stringify({lat:e,lng:t}))},loadLastLocation(){{let e=localStorage.getItem("lastLocation");return e?JSON.parse(e):{lat:5.55602,lng:-.196278}}}};function n(a){let{alerts:s,currentLat:l,currentLng:n}=a,o=(0,r.useRef)(null),i=(0,r.useRef)(null),[c,d]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{d(!0)},[]),(0,r.useEffect)(()=>{c&&o.current&&!i.current&&e.A(71400).then(e=>{let t=e.map(o.current).setView([l||5.55602,n||-.196278],16);e.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:19}).addTo(t),e.marker([l||5.55602,n||-.196278],{icon:e.icon({iconUrl:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIj48Y2lyY2xlIGN4PSIxNiIgY3k9IjE2IiByPSIxMiIgZmlsbD0iIzMzODhmZiIgb3BhY2l0eT0iMC43Ii8+PGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iNiIgZmlsbD0iIzMzODhmZiIvPjwvc3ZnPg==",iconSize:[32,32],iconAnchor:[16,16]})}).bindPopup("Current Device Location").addTo(t),s.forEach(r=>{let a=r.theft>.7?"#dc2626":r.theft>.5?"#f97316":"#eab308",s=e.circleMarker([r.lat,r.lng],{radius:8,fillColor:a,color:a,weight:2,opacity:1,fillOpacity:.7});s.bindPopup('\n          <div class="text-sm">\n            <p class="font-semibold">Alert Log</p>\n            <p>Theft: '.concat(r.theft.toFixed(2),"</p>\n            <p>V: ").concat(r.voltage.toFixed(1),"V</p>\n            <p>I: ").concat(r.current.toFixed(3),"A</p>\n            <p>").concat(new Date(r.timestamp).toLocaleString(),"</p>\n          </div>\n        ")),s.addTo(t)}),i.current=t})},[c,s,l,n]),(0,t.jsx)("div",{ref:o,className:"w-full rounded-lg shadow-lg border border-gray-300 bg-gray-600",style:{minHeight:"400px"}})}let o=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},i=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let d=(0,r.forwardRef)((e,t)=>{let{color:a="currentColor",size:s=24,strokeWidth:l=2,absoluteStrokeWidth:n,className:o="",children:d,iconNode:h,...g}=e;return(0,r.createElement)("svg",{ref:t,...c,width:s,height:s,stroke:a,strokeWidth:n?24*Number(l)/Number(s):l,className:i("lucide",o),...!d&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(g)&&{"aria-hidden":"true"},...g},[...h.map(e=>{let[t,a]=e;return(0,r.createElement)(t,a)}),...Array.isArray(d)?d:[d]])}),h=(e,t)=>{let a=(0,r.forwardRef)((a,s)=>{let{className:l,...n}=a;return(0,r.createElement)(d,{ref:s,iconNode:t,className:i("lucide-".concat(o(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),l),...n})});return a.displayName=o(e),a},g=h("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),x=h("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),p=h("wifi-off",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),m=h("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),u=h("power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]),b=h("power-off",[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),y=h("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);function f(){let[e,a]=(0,r.useState)(!1),[o,i]=(0,r.useState)(null),[c,d]=(0,r.useState)([]),[h,f]=(0,r.useState)({lat:5.55602,lng:-.196278}),[j,v]=(0,r.useState)(!1),N=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=l.loadAlerts(),t=l.loadLastLocation();d(e),f(t)},[]);let w=async()=>{try{N.current||(N.current=new s,N.current.onData(e=>{if(i(e),v(e.relay),e.alert){let t={id:Date.now().toString(),timestamp:e.timestamp,voltage:e.voltage,current:e.current,power:e.power,theft:e.theft,lat:h.lat,lng:h.lng};d(e=>{let r=[...e,t];return l.saveAlerts(r),r})}}),N.current.onConnect(()=>{a(!0)}),N.current.onDisconnect(()=>{a(!1)})),await N.current.connect()}catch(e){console.error("Connection failed:",e),alert("Failed to connect. Make sure your device is plugged in.")}},k=async()=>{N.current&&await N.current.disconnect()},C=async()=>{if(N.current)try{await N.current.sendCommand(j?"RELAY:OFF":"RELAY:ON")}catch(e){console.error("Failed to send command:",e)}};return(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 to-gray-800 text-white p-4 md:p-8",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("h1",{className:"text-4xl font-bold",children:"Smart Meter Dashboard"}),(0,t.jsx)("div",{className:"flex gap-3",children:e?(0,t.jsxs)("button",{onClick:k,className:"flex items-center gap-2 bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg transition",children:[(0,t.jsx)(p,{size:20}),"Disconnect"]}):(0,t.jsxs)("button",{onClick:w,className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition",children:[(0,t.jsx)(x,{size:20}),"Connect Device"]})})]}),(0,t.jsx)("div",{className:"p-4 rounded-lg text-center font-semibold text-lg transition ".concat(e?"bg-green-900 text-green-200 border border-green-700":"bg-gray-700 text-gray-300 border border-gray-600"),children:e?"✓ Device Connected":"✗ Disconnected"}),e&&o?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{className:"bg-gray-700 rounded-lg p-6 border border-gray-600",children:[(0,t.jsx)("p",{className:"text-gray-400 text-sm mb-2",children:"Voltage"}),(0,t.jsxs)("p",{className:"text-3xl font-bold",children:[o.voltage.toFixed(1),"V"]})]}),(0,t.jsxs)("div",{className:"bg-gray-700 rounded-lg p-6 border border-gray-600",children:[(0,t.jsx)("p",{className:"text-gray-400 text-sm mb-2",children:"Current"}),(0,t.jsxs)("p",{className:"text-3xl font-bold",children:[o.current.toFixed(3),"A"]})]}),(0,t.jsxs)("div",{className:"bg-gray-700 rounded-lg p-6 border border-gray-600",children:[(0,t.jsx)("p",{className:"text-gray-400 text-sm mb-2",children:"Power"}),(0,t.jsxs)("p",{className:"text-3xl font-bold",children:[o.power.toFixed(1),"W"]})]}),(0,t.jsxs)("div",{className:"rounded-lg p-6 border ".concat(o.alert?"bg-red-900 border-red-700":"bg-gray-700 border-gray-600"),children:[(0,t.jsx)("p",{className:"text-gray-300 text-sm mb-2",children:"Theft Risk"}),(0,t.jsx)("p",{className:"text-3xl font-bold ".concat(o.alert?"text-red-400":"text-white"),children:o.theft.toFixed(2)})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"rounded-lg p-6 border flex items-center gap-4 ".concat(o.alert?"bg-red-900 border-red-700":"bg-green-900 border-green-700"),children:[o.alert?(0,t.jsx)(m,{size:32,className:"text-red-400"}):(0,t.jsx)(g,{size:32,className:"text-green-400"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-300",children:"Status"}),(0,t.jsx)("p",{className:"text-xl font-bold",children:o.alert?"⚠ ALERT":"✓ Normal"})]})]}),(0,t.jsxs)("button",{onClick:C,className:"rounded-lg p-6 border flex items-center justify-between transition ".concat(j?"bg-blue-900 border-blue-700 hover:bg-blue-800":"bg-gray-700 border-gray-600 hover:bg-gray-600"),children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-300 text-left",children:"Relay"}),(0,t.jsx)("p",{className:"text-xl font-bold text-left",children:j?"ON":"OFF"})]}),j?(0,t.jsx)(u,{size:32,className:"text-blue-400"}):(0,t.jsx)(b,{size:32,className:"text-gray-400"})]})]}),(0,t.jsxs)("div",{className:"bg-gray-700 rounded-lg p-6 border border-gray-600",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h2",{className:"text-xl font-bold",children:"Alert Locations"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>{"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(e=>{let t={lat:e.coords.latitude,lng:e.coords.longitude};f(t),l.saveLastLocation(t.lat,t.lng)})},className:"text-xs bg-blue-600 hover:bg-blue-700 px-3 py-2 rounded transition",children:"Update Location"}),c.length>0&&(0,t.jsxs)("button",{onClick:()=>{d([]),l.saveAlerts([])},className:"text-xs bg-red-600 hover:bg-red-700 px-3 py-2 rounded transition flex items-center gap-1",children:[(0,t.jsx)(y,{size:14}),"Clear"]})]})]}),(0,t.jsx)(n,{alerts:c,currentLat:h.lat,currentLng:h.lng})]}),c.length>0&&(0,t.jsxs)("div",{className:"bg-gray-700 rounded-lg p-6 border border-gray-600 overflow-x-auto",children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Alert History"}),(0,t.jsxs)("table",{className:"w-full text-sm",children:[(0,t.jsx)("thead",{className:"border-b border-gray-600",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"text-left py-2",children:"Time"}),(0,t.jsx)("th",{className:"text-left py-2",children:"Theft"}),(0,t.jsx)("th",{className:"text-left py-2",children:"Voltage"}),(0,t.jsx)("th",{className:"text-left py-2",children:"Current"}),(0,t.jsx)("th",{className:"text-left py-2",children:"Power"}),(0,t.jsx)("th",{className:"text-left py-2",children:"Location"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-gray-600",children:c.slice().reverse().map(e=>(0,t.jsxs)("tr",{className:"hover:bg-gray-600",children:[(0,t.jsx)("td",{className:"py-2",children:new Date(e.timestamp).toLocaleTimeString()}),(0,t.jsx)("td",{className:"py-2",children:e.theft.toFixed(2)}),(0,t.jsxs)("td",{className:"py-2",children:[e.voltage.toFixed(1),"V"]}),(0,t.jsxs)("td",{className:"py-2",children:[e.current.toFixed(3),"A"]}),(0,t.jsxs)("td",{className:"py-2",children:[e.power.toFixed(1),"W"]}),(0,t.jsxs)("td",{className:"py-2",children:[e.lat.toFixed(4),", ",e.lng.toFixed(4)]})]},e.id))})]})]})]}):(0,t.jsxs)("div",{className:"bg-gray-700 rounded-lg p-12 border border-gray-600 text-center",children:[(0,t.jsx)(x,{size:48,className:"mx-auto text-gray-500 mb-4"}),(0,t.jsx)("p",{className:"text-xl text-gray-400",children:e?"Waiting for device data...":'Click "Connect Device" to start'})]})]})})}function j(){return(0,t.jsx)(f,{})}},71400,e=>{e.v(t=>Promise.all(["static/chunks/432def5dbf639c34.js"].map(t=>e.l(t))).then(()=>t(32322)))}]);